<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> 
<meta http-equiv="content-type" content="text/html; charset=UTF-8"> 
<head> 
<title>{% block title %}g2{% endblock %}</title> 
<link rel="shortcut icon" href="/images/favicon.ico" /> 
<link href="images/style.css" rel="stylesheet" type="text/css"> 
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3/jquery.min.js" type="text/javascript"></script> 
<!-- <style type="text/css">
  body, th, td { font:12px/1.4em Verdana,sans-serif; }
  div.playlist {margin-left: auto; margin-right:auto; width: 640px; }
  div.sidebar {margin-left: 10px; float: left;}
  div.banner {clear: both; float: center; margin-left: auto; margin-right:auto; width: 640px;}
  div.song {margin-left: auto; margin-right:auto; width: 630px; float: center; border-style: dotted; border-width: 1px; padding: 5px;}
  div.page-links {text-align: center; border-style: dotted; border-width: 1px; padding: 3px;}
  div.artists {margin-left: auto; margin-right:auto; width: 640px; float: center; border-width: 1px;}
  table.playlist {width: 640px;}
  p.artists {border-width: 1px; border-style: dotted; padding: 5px;}
  p.copyright {font-size: 0.7em; color: grey;}
  ol.menu {list-style-type: lower-greek;}
  div.messages {border-width: 1px; border-style: solid; width: auto; padding: 5px; border-color: red;}
  div.content {width: 640px; margin-right: auto; margin-left: auto; }
  em.bold {font-weight: bold; font-style: normal;}
  /*table.songs {text-align: center;}*/
  th.song {
  font-family: "Lucida Grande","Lucida Sans",Helvetica,Geneva,Verdana,Arial;
  color: white;
  background-color: black;
  font-size: 10px;
  border-bottom: 2px solid black;
  }
  a img {border-width: 0px;}
  /*tr {text-align: inherit;}
  td {text-align: center;}*/
  .album {font-weight: bold; text-align: center;}
  .playing {background-color: #4466bb;}
  .banned {text-decoration: line-through;}
</style>--> 
 
<script type="text/javascript" src="images/swfobject.js"></script> 
<script type="text/javascript" src="images/playload.js"></script> 
<script type="text/javascript"> 
 
 
//convert seconds to minutes:seconds
function stom(time){
  seconds = time%60;
  minutes = parseInt(time/60);
  if (seconds < 10) { 
    seconds = "0" + seconds.toString(); //add zero to single digit numbers
  } else {
    seconds = seconds.toString();
  }
  return minutes.toString() + ':' + seconds;
}
 
/*** vote handling stuff ***/
 
function voteHandler(event) {
  tgt = $(event.target);
  votelink = event.target.href;
  if (tgt.hasClass('voted')) {
    //clicking again to clear vote
    votelink = votelink.slice(0, votelink.length-1); //get rid of vote at end
    $.get(votelink + '0'); //vote 0 to clear vote
    tgt.removeClass("voted");
  } else {
    $.get(votelink);
    tgt.parent().children().removeClass("voted");
    tgt.addClass("voted");
  }
  event.preventDefault();
}
 
function addVoteHandler () {
  $("a[href*='/vote?']").not('.handled').click(voteHandler).addClass('handled');
}
 
function voteLoop() {
  addVoteHandler();
}

/*** progress bar stuff ***/
 
//both of these are in seconds
var songLength = {{song_length}};
var songPosition = {{song_position}};
//percentage
var songProgress = {{song_progress}}; 
 
function setSongLength(length) {
  songLength = length;
  $('#songLength').html(stom(length));
  
}
 
//set numeric song position
function setSongPosition(pos) {
  pos = Math.round(Math.min(pos, songLength));
  if (songPosition != pos) {
    $('#songPosition').html(stom(pos));
    songPosition = pos;
    setSongProgress((pos/songLength)*100);
  }
  ajax_args['position'] = pos;
}
 
//set progressbar percentage
function setSongProgress(percentage) {
  $("#progbar").css("width", percentage.toString() + '%');
  //alert(percentage.toString() * '%');
  songProgress = percentage;
}
 
//Increment song position every second
//TODO: make this more accurate using clock to avoid inaccuracies of delyed calls
function secondLoop() {
  setSongPosition(songPosition+1);
  setTimeout('secondLoop()', 1000);
}

/*** Clutterbar song info stuff ***/

//Set metadata to appear in clutterbar
function setClutterMetadata(metadata) {
  elem = $("div#metadata");
  old = elem.html();
  if (metadata != old) {
    elem.html(metadata);
  }
}
 
/**
* Sets up the quick search box properly
**/
function setupSearch() {
  searchbox = $('#id_query');
  searchbox.css('color', 'grey');
  searchbox.attr('value', "Quick search"); //override browser modifications
  searchbox.focus(function () {
    if (searchbox.attr('value') == "Quick search") {
      searchbox.attr('value', '');
      searchbox.css('color', 'black');
    }
  });
}
 
/**
* Hide message box
**/
function hideMessages() {
  $("p#messages").fadeOut("slow");
}
 
/*** event handlers for clutterbar ***/
 
function songLengthHandler(e, length) {
  setSongLength(length);
}
 
function songPositionHandler(e, position) {
  setSongPosition(position);
}

function linkedMetadataHandler(e, metadata) {
  setClutterMetadata(metadata);
}
 
  
/*** event loop stuff ***/
 
//delay between ajax calls
DELAY = 10000; 
 
//how long messages should show for
MESSAGES_DELAY = 5000;
 
//associative array storing args for ajax calls
//TODO: replace with array of functions to be called to obtain args
ajax_args = {}
 
 
//Called when list of events is recieved from server: triggers the correct javascript events with the correct arguments
function eventDispatcher(data) {
  for (i=0; i<data.length; i++) {
    $('body').trigger(data[i][0], [data[i][1]]);
  }
}
 
 
//Main AJAX loop: handles all periodic AJAX calls
function ajaxLoop() {
  $.getJSON("{% url playlist.views.ajax %}", ajax_args, eventDispatcher);
  setTimeout('ajaxLoop()', DELAY);
}
 
$(document).ready(function(){
  setSongLength(songLength);
  setSongPosition(songPosition);
  ajax_args['position'] = songPosition;
  $('body').bind('songPosition', songPositionHandler);
  $('body').bind('songLength', songLengthHandler);
  $('body').bind('linkedMetadata', linkedMetadataHandler);
  setupSearch();
  secondLoop();
  ajaxLoop();
  voteLoop();
  setTimeout('hideMessages()', MESSAGES_DELAY);
  
});
</script> 
 
 
{% block head %}
{% endblock %}
</head> 
 
<body> 
 
<div id="bg1"></div> 
<div id="bg2"></div> 
<div id="leftmenu"> 
<a href="{% url playlist.views.playlist %}" id="leftmenulogo"></a> 
  <ul id="mainmenu"> 
    <li><a href="{% url playlist.views.playlist %}" class="boxed">&nbsp;playlist</a></li> 
    <li><a href="{% url playlist.views.search %}" class="boxed">&nbsp;search</a></li> 
    <li><form action="{% url playlist.views.search %}" method="get" class="boxed"><input accesskey="f" id="id_query" name="query" maxlength="100" type="text" value="quick search"></form></li> 
    <li><a href="{% url playlist.views.upload %}" class="boxed">&nbsp;upload</a></li> 
    <li><a href="{% url playlist.views.search %}?query=favourites%3D{{user.username}}" class="boxed">&nbsp;favourites</a></li>
    <li><a href="{% url playlist.views.listartists "all","1" %}" class="boxed">&nbsp;artists</a></li> 
    <li><a href="{% url playlist.views.user user.id %}" class="boxed">&nbsp;user page</a></li> 
    <li><a href="{% url user_settings %}" class="boxed">&nbsp;settings</a></li> 
    <li><a href="{% url forum_index %}" class="boxed">&nbsp;forums</a></li> 
    <!--<li><a href="" class="boxed">&nbsp;irc</a></li> -->
    <li><a href="http://gbs.fm:8080/listen.pls" class="boxed">&nbsp;listen!</a></li> 
    <li><a href="#" class="boxed" onclick="flashplaypop();">&nbsp;flash player</a></li> 
    <li><a href="{% url django.contrib.auth.views.logout %}" class="boxed">&nbsp;logout</a></li> 
    {% if perms.playlist.view_g2admin %}
    <li><a href="{% url g2admin %}" class="boxed">&nbsp;g2 admin</a></li> 
    <!-- TODO: shut django up about the other one
    <a href="{#{% url admin_site %}#}"><li>Admin</li></a>--> 
    {% endif %}
  </ul> 
  <p class="listenersthing">icons from <a href="http://www.famfamfam.com/lab/icons/silk/">famfamfam</a></p> 
  <p class="listenersthing" title="g2:{{listeners}} - ghetto: who knows?">listeners: {{listeners}}</p> 
 
</div> 
 
 
{% if messages %}
  {% for message in messages %}
    <p id="messages">{{ message }}</p> 
  {% endfor %}
{% endif %}
<!-- {% if debug %}
      <p id="messages"><em>Total query count:</em> {{ sqllog|length }}<br/>
      <em>Total execution time:</em> {{ sqltime }}</p>
      {% if show_queries %}
      <div id="messages"><ul class="sqllog">
          {% for sql in sqllog %}
              <li>{{ sql.time }}: {{ sql.sql }}</li>
          {% endfor %}
      </ul></div>
      {% endif %}
      {% endif %}--> 
<div id="maincontainer"> 
{% block main %}
{% endblock %}
</div> 
 
<!-- this is the end mark i was talking about, the one you'll find with asdf23 --> 
 
<div id="bottomcont"> 
<div id="bottombg" title="geez what klutz designed this?"></div> 
 
      <div id="leftist"> 
        <form action="" method="post" id="commentform"><input accesskey="c" id="id_comment" name="query" maxlength="100" type="text" value=""></form> 
          <div id="commentsbox"> 
          <a id="expandbutt" href="#" title="expand comment box"></a> 
 
          </div> 
      </div> 
      <div id="rightist"> 
      
        <div id="progbarbox"> 
          <div id="progtube"> 
            <div style="width:{{song_progress}}%;" id="progbar"></div> 
          </div> 
          <span id="songPosition">{{song_position}}</span>/<span id="songLength">{{song_length}}</span>
        </div> 
        <span><div id="metadata">{% include "linked_metadata.html" %}</div>
        <div id="votebuttonslow"> 
        vote: 
        <a class="selectedvote" href="#">1</a> 
        <a href="#">2</a> 
        <a href="#">3</a> 
        <a href="#">4</a> 
        <a href="#">5</a> 
        &nbsp;score:
        </div></span> 
        
      </div> 
 
 
</div> 
</body> 
</html> 